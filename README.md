# Анализатор позиций Uniswap

Этот проект содержит скрипт для анализа позиций на Uniswap V3. Скрипт извлекает данные с веб-страницы позиции и выполняет необходимые вычисления.

## Функциональность

Скрипт выполняет следующие задачи:

1. **Извлечение данных с веб-страницы Uniswap:**
   - Размер позиции в USD (`positionUSD`)
   - Курс ETH (`ethRate`)
   - Fallback через API CoinGecko, если курс не найден на странице
   - Настраиваемый диапазон поиска курса ETH через аргументы командной строки

2. **Вычисления:**
   - Текущая стоимость начального эфира (`ethInitial * ethRate`)
   - Текущее значение позиции в эфирах (`positionUSD / ethRate`)

3. **Сравнения:**
   - Сравнение текущей стоимости начального эфира с текущим значением позиции
   - Сравнение начального вложения эфира с текущим значением позиции в эфирах

## Установка и запуск

### Требования

- Python 3.7+
- Google Chrome
- chromedriver

### Установка зависимостей

```bash
pip3 install -r requirements.txt
```

### Установка chromedriver для Selenium

1. Установите Google Chrome (если не установлен).
2. Скачайте chromedriver, подходящий к вашей версии Chrome:
   - https://sites.google.com/chromium.org/driver/
3. Распакуйте chromedriver и поместите его в папку, которая есть в PATH (например, /usr/local/bin) или укажите путь к chromedriver в переменной окружения PATH.
4. Проверьте установку:
   ```bash
   chromedriver --version
   ```

### Запуск

#### Способ 1: Использование shell скрипта с виртуальным окружением (рекомендуется)

```bash
./run_analysis_venv.sh
```

Этот скрипт автоматически:
- Создает виртуальное окружение Python (если не существует)
- Активирует виртуальное окружение
- Устанавливает все зависимости из requirements.txt
- Запускает анализ позиции
- Деактивирует виртуальное окружение

#### Способ 2: Использование обычного shell скрипта

```bash
./run_analysis.sh
```

#### Способ 3: Ручной запуск

```bash
python3 uniswap_analyzer.py
```

### Аргументы командной строки

Все скрипты поддерживают следующие аргументы:

- `-n, --eth_min VALUE` - минимальный курс ETH для поиска (значение по умолчанию задается в uniswap_analyzer.py)
- `-x, --eth_max VALUE` - максимальный курс ETH для поиска (значение по умолчанию задается в uniswap_analyzer.py)
- `-p, --position VALUE` - номер позиции Uniswap (значение по умолчанию задается в uniswap_analyzer.py)
- `-i, --eth_initial VALUE` - начальное количество ETH (значение по умолчанию задается в uniswap_analyzer.py)
- `-h, --help` - показать справку

**Примеры использования с аргументами:**
```bash
# Запуск с параметрами по умолчанию
./run_analysis_venv.sh
./run_analysis.sh

# Запуск с пользовательскими параметрами
./run_analysis_venv.sh -p 12345 -i 50.0
./run_analysis.sh --eth_min 1500 --eth_max 3500 --position 67890 --eth_initial 25.5

# Показать справку
./run_analysis_venv.sh --help
./run_analysis.sh -h
```

## Структура проекта

```
UniswapPositions/
├── uniswap_analyzer.py      # Основной скрипт анализа
├── requirements.txt         # Зависимости Python
├── run_analysis_venv.sh     # Shell скрипт для запуска с виртуальным окружением
├── run_analysis.sh          # Shell скрипт для запуска
├── README.md                # Документация
├── .gitignore              # Исключения для git
├── uniswapAnalize.txt      # Задание для анализа
└── venv/                   # Виртуальное окружение Python (создается автоматически)
```

## Пример вывода

```
Анализ позиции Uniswap...
URL: https://app.uniswap.org/positions/v3/unichain/59044
Начальное количество ETH: 38.1
--------------------------------------------------
Открываем страницу...
Ждем загрузки данных...
HTML страницы сохранен в debug_page.html
Найдено 55 текстовых элементов
Найдено 6 элементов с символом $
Примеры элементов с $:
  1: $93,676.56
  2: $79,265.81
  3: $14,410.75
  4: $887.87
  5: $753.86
Извлечено значение позиции из первого элемента: $93,676.56
Найдено значение курса ETH: $2,315.77
Размер позиции: $93,676.56
Курс ETH: $2,315.77
--------------------------------------------------
СРАВНЕНИЕ 1:
Текущая стоимость начального эфира: $88,230.81
Текущее значение позиции: $93,676.56
--------------------------------------------------
СРАВНЕНИЕ 2:
Начальное вложение эфира: 38.1 ETH
Текущее значение позиции в эфирах: 40.47 ETH
--------------------------------------------------
Позиция показывает прибыль: $5,445.75
Позиция в ETH показывает рост: +2.37 ETH
```

## Технические детали

- **Selenium WebDriver**: Используется для эмуляции браузера и извлечения данных с динамически загружаемых страниц
- **Регулярные выражения**: Для парсинга числовых значений из HTML
- **Headless режим**: Браузер запускается в фоновом режиме без GUI
- **argparse**: Для обработки аргументов командной строки
- **API CoinGecko**: Fallback для получения курса ETH, если не найден на странице

## Устранение неполадок

1. **Ошибка "chromedriver not found"**: Убедитесь, что chromedriver установлен и доступен в PATH
2. **Ошибка "Не удалось извлечь данные"**: Проверьте файл `debug_page.html` для анализа структуры страницы
3. **Медленная загрузка**: Увеличьте время ожидания в скрипте (параметр `time.sleep()`)
4. **Курс ETH не найден**: Проверьте диапазон поиска в константах `ETH_RATE_MIN` и `ETH_RATE_MAX`
5. **Ошибки с аргументами**: Используйте `-h` или `--help` для просмотра справки

## Лицензия

MIT License 